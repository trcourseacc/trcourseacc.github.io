<!DOCTYPE html>
<html lang="fi">

<head>

    <title>Tehtävä 2</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Oma tyylitiedosto -->
    <link rel="stylesheet" href="../style.css">

</head>

<body>

    <!-- Navi -->
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top">
        <div class="container-fluid">

            <!-- Sivun otsikko -->
            <a class="navbar-brand" href="index.html">Digitekniikat</a>

            <!-- Hampurilaisvalikko pienille näytöille -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Valikon linkit -->
            <div class="collapse navbar-collapse" id="nav">
                <ul class="navbar-nav ms-auto">

                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Etusivu (Tehtävä 1 OSA I)</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="toteutus.html">Tehtävä 1 OSA II</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link active" href="poke.html">Poke haku (Tehtävä 2)</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="saa.html">Sää (Tehtävä 3)</a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">

        <h1>Pokemon haku</h1>

        <input type="text" id="pokemonName" placeholder="Enter Pokemon name">
        <button type="button" onclick="poke()">Hae</button><br><br>

        <div id="kaanna"></div>
        <div id="lisatiedot"></div>
        <div id="nimi">Kirjoita laatikkoon Pokemonin nimi</div>
        <p id="kuva2"></p>


    </div>

    <script>

        function poke() {

            // Tyhjennetään vanhat lisätiedot ennen uutta hakua
            document.getElementById("lisatiedot").innerHTML = "";

            // Tallennetaan annettu Poken nimi muuttujaan pokeName, muutetaan se samalla pieniksi kirjaimiksi
            const pokeName = document.getElementById("pokemonName").value.toLowerCase();

            // Tallennetaan myös nimi talteen muuttujaan name
            let name = document.getElementById("pokemonName").value;

            fetch(`https://pokeapi.co/api/v2/pokemon/${pokeName}`)

                // Muunnetaan vastaus JSON-muotoon
                .then(function (response) {
                    return response.json();
                })
                // Käsitellään JSON-vastaus
                .then(function (responseJson) {
                    pokekuva(responseJson, name);
                })
                // Jos tuli jokin virhe, virheilmoitus ja kenttien tyhjennys
                .catch(function () {
                    document.getElementById("nimi").innerHTML = "<p>Tietoa ei pystytä hakemaan</p>";
                    document.getElementById("kuva2").innerHTML = "";
                    document.getElementById("kaanna").innerHTML = "";
                    document.getElementById("lisatiedot").innerHTML = "";
                });

        }

        function pokekuva(obj, name) {
            // Tallennetaan linkki josta löytyy Pokemonin kuva
            let kuva2 = obj.sprites.front_default;

            // Kirjoitetaan kuva ja nimi sivulle sekä tyhjennetään hakukenttä
            document.getElementById("kuva2").innerHTML = "<img src='" + kuva2 + "'>";
            document.getElementById("nimi").innerHTML = "<b>" + name + "</b>";
            document.getElementById("pokemonName").value = "";
            // Käännä-painike vasta haun jälkeen
            document.getElementById("kaanna").innerHTML =
                "<button type='button' onclick='kaanna()'>Käännä</button>";
        }

        function kaanna() {

            // Luetaan nimi
            let name = document.getElementById("nimi").innerText;
            let pokeName = name.toLowerCase();

            fetch(`https://pokeapi.co/api/v2/pokemon/${pokeName}`)
                .then(function (response) {
                    return response.json();
                })
                .then(function (responseJson) {
                    let kuva3 = responseJson.sprites.back_default;
                    document.getElementById("kuva2").innerHTML = "<img src='" + kuva3 + "'>";

                    // 3 lisätietoa: type, id, stats (HP)
                    let type = responseJson.types[0].type.name;
                    let id = responseJson.id;
                    let hp = responseJson.stats[0].base_stat;

                    document.getElementById("lisatiedot").innerHTML =
                        "Type: " + type + "<br>" +
                        "ID: " + id + "<br>" +
                        "HP: " + hp;

                })
                .catch(function () {
                    document.getElementById("nimi").innerHTML = "<p>Tietoa ei pystytä hakemaan</p>";
                    document.getElementById("kuva2").innerHTML = "";
                    document.getElementById("kaanna").innerHTML = "";
                    document.getElementById("lisatiedot").innerHTML = "";
                });
        }
    </script>

    <!-- Bootstrapin toiminnot (pudotusvalikko ja hampurilainen) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>